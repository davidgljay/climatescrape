(function() {
  var MongoQueue, getItem, _;

  _ = require("lodash");

  getItem = require("./QueueItem");

  module.exports = MongoQueue = (function() {
    function MongoQueue(mongo, crawler) {
      var event, eventstates, query, setEventHandler, status;
      this.crawler = crawler;
      console.log("Initializing mongo queue for " + this.crawler.name);
      this.Item = getItem(mongo, this.crawler.name);
      this.updateStatus = function(item, status) {
        console.log("" + status + " \t " + item.url);
        item.set({
          status: status
        });
        return item.save(function(error) {
          if (error) {
            throw error;
          }
        });
      };
      eventstates = {
        fetchstart: 'spooled',
        fetchcomplete: 'fetched',
        fetcherror: 'error',
        fetchredirect: 'redirected'
      };
      setEventHandler = (function(_this) {
        return function(event, status) {
          return _this.crawler.on(event, function(item) {
            return _this.updateStatus(item, status);
          });
        };
      })(this);
      for (event in eventstates) {
        status = eventstates[event];
        setEventHandler(event, status);
      }
      query = {
        status: 'spooled',
        crawler: this.crawler.name
      };
      this.Item.update(query, {
        status: 'queued'
      }, {
        multi: true
      }, function(error) {
        if (error) {
          throw error;
        }
      });
    }

    MongoQueue.prototype.add = function(protocol, host, port, path, callback) {
      var data;
      data = {
        protocol: protocol,
        host: host,
        port: port,
        path: path,
        crawler: this.crawler.name
      };
      return this.Item.findOne(data, (function(_this) {
        return function(error, item) {
          if (item) {
            item.set(data);
          } else {
            item = new _this.Item(data);
          }
          return item.save(callback);
        };
      })(this));
    };

    MongoQueue.prototype.exists = function(protocol, domain, port, path, callback) {
      var data;
      data = {
        protocol: protocol,
        domain: domain,
        port: port,
        path: path,
        crawler: this.crawler.name
      };
      return this.Item.count(data, callback);
    };

    MongoQueue.prototype.getLength = function(callback) {
      return this.Item.count({
        crawler: this.crawler.name
      }, callback);
    };

    MongoQueue.prototype.last = function(callback) {
      return this.Item.findOne({
        crawler: this.crawler.name
      }).sort({
        id: -1
      }).exec(callback);
    };

    MongoQueue.prototype.get = function(id, callback) {
      return this.Item.findById(id, callback);
    };

    MongoQueue.prototype.oldestUnfetchedItem = function(callback) {
      var query;
      query = {
        crawler: this.crawler.name,
        status: 'queued'
      };
      return this.Item.findOneAndUpdate(query, {
        status: 'spooled'
      }, callback);
    };

    MongoQueue.prototype.max = function(statisticname, callback) {
      return process.nextTick(function() {
        return callback(null, 0);
      });
    };

    MongoQueue.prototype.min = function(statisticname, callback) {
      return process.nextTick(function() {
        return callback(null, 0);
      });
    };

    MongoQueue.prototype.avg = function(statisticname, callback) {
      return process.nextTick(function() {
        return callback(null, 0);
      });
    };

    MongoQueue.prototype.complete = function(callback) {
      return process.nextTick(function() {
        return callback(null, 0);
      });
    };

    MongoQueue.prototype.countWithStatus = function(status, callback) {
      return this.Item.count({
        status: status,
        crawler: this.crawler.name
      });
    };

    MongoQueue.prototype.getWithStatus = function(status, callback) {
      return this.Item.find({
        status: status,
        crawler: this.crawler.name
      }, callback);
    };

    MongoQueue.prototype.errors = function(callback) {
      return this.Item.count({
        status: 'error',
        crawler: this.crawler.name
      }, callback);
    };

    MongoQueue.prototype.freeze = function(filename, callback) {
      return process.nextTick(function() {
        return callback(null);
      });
    };

    MongoQueue.prototype.defrost = function(filename, callback) {
      return process.nextTick(function() {
        return callback(null);
      });
    };

    return MongoQueue;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,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SUFBVCxFQUFIO01BQUEsQ0FBakIsRUFGTTtJQUFBLENBaElSLENBQUE7O0FBQUEseUJBcUlBLE9BQUEsR0FBUyxTQUFDLFFBQUQsRUFBVyxRQUFYLEdBQUE7YUFFUCxPQUFPLENBQUMsUUFBUixDQUFpQixTQUFBLEdBQUE7ZUFBRyxRQUFBLENBQVMsSUFBVCxFQUFIO01BQUEsQ0FBakIsRUFGTztJQUFBLENBcklULENBQUE7O3NCQUFBOztNQUpGLENBQUE7QUFBQSIsImZpbGUiOiJNb25nb1F1ZXVlLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyBUT0RPOiBXZSBhc3N1bWUgdGhhdCB0aGVyZSBpcyBhIGNvbm5lY3Rpb24gdG8gbW9uZ28gZXN0YWJsaXNoZWQgYnkgY3Jhd2xlciBhcHBcblxuXyAgICAgICAgPSByZXF1aXJlIFwibG9kYXNoXCJcbmdldEl0ZW0gID0gcmVxdWlyZSBcIi4vUXVldWVJdGVtXCJcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBNb25nb1F1ZXVlXG4gIGNvbnN0cnVjdG9yOiAobW9uZ28sIEBjcmF3bGVyKSAtPlxuICAgIGNvbnNvbGUubG9nIFwiSW5pdGlhbGl6aW5nIG1vbmdvIHF1ZXVlIGZvciAje0BjcmF3bGVyLm5hbWV9XCJcbiAgICBASXRlbSA9IGdldEl0ZW0gbW9uZ28sIEBjcmF3bGVyLm5hbWVcblxuICAgICMgVXBkYXRlIHN0YXR1cyBvZiBpdGVtcyBpbiBkYiBvbiBjcmF3bGVyIGV2ZW50c1xuICAgIEB1cGRhdGVTdGF0dXMgPSAoaXRlbSwgc3RhdHVzKSAtPlxuICAgICAgY29uc29sZS5sb2cgXCIje3N0YXR1c30gXFx0ICN7aXRlbS51cmx9XCJcbiAgICAgIGl0ZW0uc2V0IHtzdGF0dXN9XG4gICAgICBpdGVtLnNhdmUgKGVycm9yKSAtPlxuICAgICAgICBpZiBlcnJvciB0aGVuIHRocm93IGVycm9yXG5cbiAgICBldmVudHN0YXRlcyA9XG4gICAgICAjIFNFRTogUXVldWVJdGVtI3N0YXR1c1xuICAgICAgZmV0Y2hzdGFydCAgIDogJ3Nwb29sZWQnXG4gICAgICBmZXRjaGNvbXBsZXRlOiAnZmV0Y2hlZCdcbiAgICAgIGZldGNoZXJyb3IgICA6ICdlcnJvcidcbiAgICAgIGZldGNocmVkaXJlY3Q6ICdyZWRpcmVjdGVkJ1xuXG4gICAgc2V0RXZlbnRIYW5kbGVyID0gKGV2ZW50LCBzdGF0dXMpID0+XG4gICAgICBAY3Jhd2xlci5vbiBldmVudCwgKGl0ZW0pID0+XG4gICAgICAgIEB1cGRhdGVTdGF0dXMgaXRlbSwgc3RhdHVzXG5cbiAgICBzZXRFdmVudEhhbmRsZXIgZXZlbnQsIHN0YXR1cyBmb3IgZXZlbnQsIHN0YXR1cyBvZiBldmVudHN0YXRlc1xuXG4gICAgIyBSZXNldCBhbGwgc3Bvb2xlZCBpdGVtcyB0byBxdWV1ZWRcbiAgICAjIElmIHRoZSBxdWV1ZSB3YXMgY2xvc2VkIChlLmcuIGFwcCB3YXMgdGVybWluYXRlZCkgd2l0aCBzb21lIHNwb29sZWQgaXRlbXNcbiAgICAjIHdlIHdhbnQgdGhlbSB0byBiZSByZXF1ZXVlZFxuICAgIHF1ZXJ5ID1cbiAgICAgIHN0YXR1cyA6ICdzcG9vbGVkJ1xuICAgICAgY3Jhd2xlcjogQGNyYXdsZXIubmFtZVxuICAgIEBJdGVtLnVwZGF0ZSBxdWVyeSxcbiAgICAgIHtzdGF0dXMgOiAncXVldWVkJ30sXG4gICAgICB7bXVsdGkgIDogeWVzfSxcbiAgICAgIChlcnJvcikgLT4gaWYgZXJyb3IgdGhlbiB0aHJvdyBlcnJvclxuXG5cbiAgIyBBZGQgaXRlbSB0byBxdWV1ZVxuICBhZGQ6IChwcm90b2NvbCwgaG9zdCwgcG9ydCwgcGF0aCwgY2FsbGJhY2spIC0+XG4gICAgZGF0YSA9IHtcbiAgICAgIHByb3RvY29sXG4gICAgICBob3N0XG4gICAgICBwb3J0XG4gICAgICBwYXRoXG4gICAgICBjcmF3bGVyOiBAY3Jhd2xlci5uYW1lXG4gICAgfVxuICAgIEBJdGVtLmZpbmRPbmUgZGF0YSwgKGVycm9yLCBpdGVtKSA9PlxuICAgICAgaWYgaXRlbVxuICAgICAgICBpdGVtLnNldCBkYXRhXG4gICAgICBlbHNlXG4gICAgICAgIGl0ZW0gPSBuZXcgQEl0ZW0gZGF0YVxuXG4gICAgICBpdGVtLnNhdmUgY2FsbGJhY2tcblxuICAjIENoZWNrIGlmIGFuIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gdGhlIHF1ZXVlLi4uXG4gIGV4aXN0czogKHByb3RvY29sLCBkb21haW4sIHBvcnQsIHBhdGgsIGNhbGxiYWNrKSAtPlxuICAgIGRhdGEgPSB7XG4gICAgICBwcm90b2NvbFxuICAgICAgZG9tYWluXG4gICAgICBwb3J0XG4gICAgICBwYXRoXG4gICAgICBjcmF3bGVyOiBAY3Jhd2xlci5uYW1lXG4gICAgfVxuICAgIEBJdGVtLmNvdW50IGRhdGEsIGNhbGxiYWNrXG5cbiAgZ2V0TGVuZ3RoOiAoY2FsbGJhY2spIC0+XG4gICAgQEl0ZW0uY291bnQgY3Jhd2xlcjogQGNyYXdsZXIubmFtZSwgY2FsbGJhY2tcblxuICAjIEdldCBsYXN0IGl0ZW0gaW4gcXVldWUuLi5cbiAgbGFzdDogKGNhbGxiYWNrKSAtPlxuICAgIEBJdGVtXG4gICAgICAuZmluZE9uZSBjcmF3bGVyOiBAY3Jhd2xlci5uYW1lXG4gICAgICAuc29ydCBpZDogLTFcbiAgICAgIC5leGVjIGNhbGxiYWNrXG5cbiAgIyBHZXQgaXRlbSBmcm9tIHF1ZXVlXG4gIGdldDogKGlkLCBjYWxsYmFjaykgLT5cbiAgICBASXRlbS5maW5kQnlJZCBpZCwgY2FsbGJhY2tcblxuICAjIEdldCBmaXJzdCB1bmZldGNoZWQgaXRlbSBpbiB0aGUgcXVldWUgKGFuZCByZXR1cm4gaXRzIGluZGV4KVxuICBvbGRlc3RVbmZldGNoZWRJdGVtOiAoY2FsbGJhY2spIC0+XG4gICAgcXVlcnkgPVxuICAgICAgY3Jhd2xlcjogQGNyYXdsZXIubmFtZVxuICAgICAgc3RhdHVzIDogJ3F1ZXVlZCdcblxuICAgIEBJdGVtLmZpbmRPbmVBbmRVcGRhdGUgcXVlcnksIHN0YXR1czogJ3Nwb29sZWQnLCBjYWxsYmFja1xuXG4gICMgR2V0cyB0aGUgbWF4aW11bSB0b3RhbCByZXF1ZXN0IHRpbWUsIHJlcXVlc3QgbGF0ZW5jeSwgb3IgZG93bmxvYWQgdGltZVxuICBtYXg6IChzdGF0aXN0aWNuYW1lLCBjYWxsYmFjaykgLT5cbiAgICAjIFRPRE86IExhdGVyLiBTdGF0aXN0aWNzIHJlcXVpcmUgYWRkaXRpb25hbCBmaWVsZHMgaW4gbW9kZWwuXG4gICAgcHJvY2Vzcy5uZXh0VGljayAtPiBjYWxsYmFjayBudWxsLCAwXG5cbiAgIyBHZXRzIHRoZSBtaW5pbXVtIHRvdGFsIHJlcXVlc3QgdGltZSwgcmVxdWVzdCBsYXRlbmN5LCBvciBkb3dubG9hZCB0aW1lXG4gIG1pbjogKHN0YXRpc3RpY25hbWUsIGNhbGxiYWNrKSAtPlxuICAgICMgVE9ETzogTGF0ZXIuIFN0YXRpc3RpY3MgcmVxdWlyZSBhZGRpdGlvbmFsIGZpZWxkcyBpbiBtb2RlbC5cbiAgICBwcm9jZXNzLm5leHRUaWNrIC0+IGNhbGxiYWNrIG51bGwsIDBcblxuICAjIEdldHMgdGhlIG1pbmltdW0gdG90YWwgcmVxdWVzdCB0aW1lLCByZXF1ZXN0IGxhdGVuY3ksIG9yIGRvd25sb2FkIHRpbWVcbiAgYXZnOiAoc3RhdGlzdGljbmFtZSwgY2FsbGJhY2spIC0+XG4gICAgIyBUT0RPOiBMYXRlci4gU3RhdGlzdGljcyByZXF1aXJlIGFkZGl0aW9uYWwgZmllbGRzIGluIG1vZGVsLlxuICAgIHByb2Nlc3MubmV4dFRpY2sgLT4gY2FsbGJhY2sgbnVsbCwgMFxuXG4gICMgR2V0cyB0aGUgbnVtYmVyIG9mIHJlcXVlc3RzIHdoaWNoIGhhdmUgYmVlbiBjb21wbGV0ZWQuXG4gIGNvbXBsZXRlOiAoY2FsbGJhY2spIC0+XG4gICAgIyBUT0RPOiBMYXRlci4gU3RhdGlzdGljcyByZXF1aXJlIGFkZGl0aW9uYWwgZmllbGRzIGluIG1vZGVsLlxuICAgIHByb2Nlc3MubmV4dFRpY2sgLT4gY2FsbGJhY2sgbnVsbCwgMFxuXG4gICMgR2V0cyB0aGUgbnVtYmVyIG9mIHF1ZXVlIGl0ZW1zIHdpdGggdGhlIGdpdmVuIHN0YXR1c1xuICBjb3VudFdpdGhTdGF0dXM6IChzdGF0dXMsIGNhbGxiYWNrKSAtPlxuICAgIEBJdGVtLmNvdW50IHtcbiAgICAgIHN0YXR1c1xuICAgICAgY3Jhd2xlcjogQGNyYXdsZXIubmFtZVxuICAgIH1cblxuICAjIEdldHMgdGhlIG51bWJlciBvZiBxdWV1ZSBpdGVtcyB3aXRoIHRoZSBnaXZlbiBzdGF0dXNcbiAgZ2V0V2l0aFN0YXR1czogKHN0YXR1cywgY2FsbGJhY2spIC0+XG4gICAgQEl0ZW0uZmluZCB7XG4gICAgICBzdGF0dXNcbiAgICAgIGNyYXdsZXI6IEBjcmF3bGVyLm5hbWVcbiAgICB9LCBjYWxsYmFja1xuXG4gICMgR2V0cyB0aGUgbnVtYmVyIG9mIHJlcXVlc3RzIHdoaWNoIGhhdmUgZmFpbGVkIGZvciBzb21lIHJlYXNvblxuICBlcnJvcnM6IChjYWxsYmFjaykgLT5cbiAgICBASXRlbS5jb3VudFxuICAgICAgc3RhdHVzOiAnZXJyb3InXG4gICAgICBjcmF3bGVyOiBAY3Jhd2xlci5uYW1lXG4gICAgICBjYWxsYmFja1xuXG4gICMgV3JpdGVzIHRoZSBxdWV1ZSB0byBkaXNrXG4gIGZyZWV6ZTogKGZpbGVuYW1lLCBjYWxsYmFjaykgLT5cbiAgICAjIFRPRE86IExhdGVyLiBUaGUgcXVldWUgaXMgYmFja2VkIGJ5IE1vbmdvREIsIHNvIGZyZWV6ZSBoYXMgbG93IHByaW9yaXR5XG4gICAgcHJvY2Vzcy5uZXh0VGljayAtPiBjYWxsYmFjayBudWxsXG5cbiAgIyBSZWFkcyB0aGUgcXVldWUgZnJvbSBkaXNrXG4gIGRlZnJvc3Q6IChmaWxlbmFtZSwgY2FsbGJhY2spIC0+XG4gICAgIyBUT0RPOiBMYXRlci4gVGhlIHF1ZXVlIGlzIGJhY2tlZCBieSBNb25nb0RCLCBzbyBkZWZyb3N0IGhhcyBsb3cgcHJpb3JpdHlcbiAgICBwcm9jZXNzLm5leHRUaWNrIC0+IGNhbGxiYWNrIG51bGxcbiJdfQ==